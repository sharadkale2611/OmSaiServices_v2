@model OmSaiModels.Worker.ProfileImageModel
@{
    ViewData["Title"] = "Worker Profile";

    var worker = @ViewBag.AllData;
    var fullName = worker.FirstName + " " + worker.MiddleName + " " + worker.LastName;
    var attendanceHistory = ViewBag.AttendanceHistory; //test commentn
    var address = ViewBag.Addresses;

    var PermanentAddress = address[0]?.Address ?? "";
    var CurrentAddress = address[1]?.Address ?? "";
    int serialNumber = 0;

    var attendanceMonth = ViewBag.AttendanceMonth as string;
}

<style>

    .selfie-image {
        width: 40px;
        border: 1px solid #eee;
        border-radius: 5px;
        box-shadow: 1px 1px 3px gray;
    }

    .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr); /* 7 columns for the days of the week */
        gap: 5px;
    }

    .calendar-box {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
    }

        .calendar-box.present {
            background-color: #28a745; /* Green for Present */
            color: #fff;
        }

        .calendar-box.absent {
            background-color: #dc3545; /* Red for Absent */
            color: #fff;
        }

        .calendar-box.empty {
            background-color: #f8f9fa; /* Light gray for empty days */
        }

    .calendar-header {
        text-align: center;
        font-weight: bold;
        margin-bottom: 10px;
    }

        .calendar-header .col {
            width: 30px;
            height: 30px;
            font-size: 11px;
            text-align: center;
        }

</style>

<div class="my-3 my-md-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                
                <div class="card">
                    <div class="card-header d-flex">
                        <a asp-area="worker" asp-controller="worker" asp-action="Edit" asp-route-id="@worker.WorkerId" class="btn btn-outline-warning ml-1">
                            <i class="fe fe-edit"></i> Edit Profile
                        </a>
                        <a class="btn btn-outline-warning ml-1">
                            <i class="fe fe-lock"></i> Change Password
                        </a>
                        <!-- Upload Profile Image Button -->
                        <button type="button" class="btn btn-primary ml-auto btn-upload2" data-worker-id="@worker.WorkerId" data-bs-toggle="modal" data-bs-target="#ppUploadImageModal">
                            Upload Profile Image
                        </button>
                    </div>
                </div>
                

                <div class="card">
                    <div class="card-body">
                        <div class="media">
                           
                            <!-- Profile Image Display -->
                            @if (Model != null && !string.IsNullOrEmpty(Model.ProfileImage))
                            {
                                <div class="text-center mt-3">
                                    <span id="profileImage" class="avatar avatar-xxl" style="background-image: url('@(Model.ProfileImage)')"></span>
                                </div>
                            }
                            else
                            {
                                <div class="text-center mt-3">
                                    <span id="profileImage" class="avatar avatar-xxl" style="background-image: url('/demo/faces/male/21.jpg')"></span>
                                </div>
                            }
                            <div class="media-body">
                                <h4 class="m-0 mb-1">@fullName</h4>
                                <p class="text-muted mb-1"><b class="text-info">@worker.WorkmanId</b> [ <b>@worker.DepartmentName</b>]</p>
                                <p class="text-muted mb-1">Qualification: <b>@worker.QualificationName</b></p>

                                <ul class="social-links list-inline mb-0 mt-2">
                                    <li class="list-inline-item">
                                        <i class="fa fa-phone"></i> &nbsp;&nbsp; @worker.MobileNumbers
                                    </li>
                                </ul>
                                <p><b>Joining Date: </b> @worker.DateofJoining </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Address</h3>
                    </div>

                    <div class="card-body">
                        <div class="media">
                            <div class="media-body">
                                <b>Permanent Address: </b>
                                <p class="text-muted mb-0">@PermanentAddress</p>
                                <hr />
                                <b>Current Address: </b>
                                <p class="text-muted mb-0">@CurrentAddress</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Project And Site</h3>
                    </div>

                    <div class="card-body">
                        <div class="media">
                            <div class="media-body">
                                <p class="m-0"><b>@worker.ProjectName</b></p>
                                <p class="text-muted mb-0">Site: <b>@worker.SiteName, @worker.SiteLocation</b></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">

                        <div class="container p-2">
                            <h2 class="text-center mb-4">Current Month Attendace</h2>
                            <!-- Attendance Summary -->

                            <h2>Attendance Summary for @attendanceMonth</h2>
                            <div>
                                <p>Present: <span id="PresentCount">@ViewBag.PresentCount</span></p>
                                <p>Absent: <span id="AbsentCount">@ViewBag.AbsentCount</span></p>
                                <p>Leave: <span id="LeaveCount">@ViewBag.LeaveCount</span></p>
                                <p>Miss: <span id="MissCount">@ViewBag.MissCount</span></p>
                            </div>
                            <!-- Attendance Month Filter -->
                            <form method="get" action="@Url.Action("Profile", "Worker", new { id = ViewBag.AllData.WorkerId })">
                                <label for="attendanceMonth">Choose Month:</label>
                                <select id="attendanceMonth" name="attendanceMonth" onchange="this.form.submit()">
                                    @Html.Raw("<option value='January' " + (attendanceMonth == "January" ? "selected='selected'" : "") + ">January</option>")
                                    @Html.Raw("<option value='February' " + (attendanceMonth == "February" ? "selected='selected'" : "") + ">February</option>")
                                    @Html.Raw("<option value='March' " + (attendanceMonth == "March" ? "selected='selected'" : "") + ">March</option>")
                                    @Html.Raw("<option value='April' " + (attendanceMonth == "April" ? "selected='selected'" : "") + ">April</option>")
                                    @Html.Raw("<option value='May' " + (attendanceMonth == "May" ? "selected='selected'" : "") + ">May</option>")
                                    @Html.Raw("<option value='June' " + (attendanceMonth == "June" ? "selected='selected'" : "") + ">June</option>")
                                    @Html.Raw("<option value='July' " + (attendanceMonth == "July" ? "selected='selected'" : "") + ">July</option>")
                                    @Html.Raw("<option value='August' " + (attendanceMonth == "August" ? "selected='selected'" : "") + ">August</option>")
                                    @Html.Raw("<option value='September' " + (attendanceMonth == "September" ? "selected='selected'" : "") + ">September</option>")
                                    @Html.Raw("<option value='October' " + (attendanceMonth == "October" ? "selected='selected'" : "") + ">October</option>")
                                    @Html.Raw("<option value='November' " + (attendanceMonth == "November" ? "selected='selected'" : "") + ">November</option>")
                                    @Html.Raw("<option value='December' " + (attendanceMonth == "December" ? "selected='selected'" : "") + ">December</option>")
                                </select>
                            </form>



                            <!-- Calendar Header -->
                            <div class="calendar-header row text-center">
                                <div class="col">Sun</div>
                                <div class="col">Mon</div>
                                <div class="col">Tue</div>
                                <div class="col">Wed</div>
                                <div class="col">Thu</div>
                                <div class="col">Fri</div>
                                <div class="col">Sat</div>
                            </div>

                            <!-- Calendar Grid -->
                            <div class="calendar">
                                <!-- Empty Days (for alignment) -->
                                <div class="calendar-box empty"></div>
                                <div class="calendar-box empty"></div>
                                <div class="calendar-box empty"></div>
                                <div class="calendar-box empty"></div>

                                <!-- Days with Present/Absent Status -->
                                <div class="calendar-box present">1</div>
                                <div class="calendar-box absent">2</div>
                                <div class="calendar-box present">3</div>
                                <div class="calendar-box absent">4</div>
                                <div class="calendar-box present">5</div>
                                <div class="calendar-box present">6</div>
                                <div class="calendar-box absent">7</div>
                                <div class="calendar-box present">8</div>
                                <div class="calendar-box absent">9</div>
                                <div class="calendar-box absent">10</div>
                                <div class="calendar-box present">11</div>
                                <div class="calendar-box present">12</div>
                                <div class="calendar-box absent">13</div>
                                <div class="calendar-box present">14</div>
                                <div class="calendar-box present">15</div>
                                <div class="calendar-box absent">16</div>
                                <div class="calendar-box present">17</div>
                                <div class="calendar-box absent">18</div>
                                <div class="calendar-box absent">19</div>
                                <div class="calendar-box present">20</div>
                                <div class="calendar-box absent">21</div>
                                <div class="calendar-box present">22</div>
                                <div class="calendar-box absent">23</div>
                                <div class="calendar-box present">24</div>
                                <div class="calendar-box absent">25</div>
                                <div class="calendar-box absent">26</div>
                                <div class="calendar-box present">27</div>
                                <div class="calendar-box present">28</div>
                                <div class="calendar-box absent">29</div>
                                <div class="calendar-box present">30</div>
                            </div>
                        </div>


                    </div>
                </div>




            </div>
            <div class="col-lg-8">

                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Worker Attendance</h4>
                    </div>
                    <div class="table-responsive">

                        <table class="table card-table table-vcenter text-nowrap">
                            <thead>
                                <tr>
                                    <th class="w-1">No.</th>
                                    <th>Date</th>
                                    <th>Site Name</th>
                                    <th>In Time</th>
                                    <th>Out Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var attendance in attendanceHistory)
                                {
                                    serialNumber++;
                                    <tr>
                                        <td>@serialNumber</td>
                                        <td>@attendance.CreatedAt?.ToString("ddd, dd MMM yy")</td>
                                        <td>@attendance.SiteName</td>
                                        <td>
                                            <img src="@attendance.InSelfiPath" class="selfie-image" />
                                            @attendance.InTime?.ToString("hh:mm tt")
                                        </td>
                                        <td>
                                            <img src="@attendance.OutSelfiPath" class="selfie-image" />
                                            @attendance.OutTime?.ToString("hh:mm tt")
                                        </td>
                                        <td>

                                            @if (attendance.Status == "Present")
                                            {
                                                <span class="badge bg-success">P</span> @attendance.Status
                                            }
                                            else if (attendance.Status == "Absent")
                                            {
                                                <span class="badge bg-danger">A</span> @attendance.Status
                                            }
                                            else if (attendance.Status == "Miss")
                                            {
                                                <span class="badge bg-warning">I</span> @("In")
                                            }
                                            else
                                            {
                                                <span class="badge bg-dark">@attendance.Status</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h4>Worker Documents</h4>
                    </div>

                    <div class="table-responsive">
                        <table class="table card-table table-vcenter text-nowrap">
                            <thead>
                                <tr>
                                    <th class="w-1">No.</th>
                                    <th>Document Name</th>
                                    <th>Uploads</th>
                                    <th>Last Updated</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    serialNumber = 0;
                                }

                                @foreach (var doc in ViewBag.WorkerDocuments)
                                {
                                    serialNumber++;
                                    <tr>
                                        <td>@serialNumber</td>
                                        <td>@doc.DocumentName</td>
                                        <td>
                                            @if (@doc.IsDocumentImage == true)
                                            {
                                                @if (!string.IsNullOrEmpty(doc.DocumentImage))
                                                {
                                                    <a href="~/@doc.DocumentImage" target="_blank">
                                                        <img src="~/@doc.DocumentImage" alt="Uploaded Document" class="media-object mr-4" style="max-height:50px;" />
                                                    </a>
                                                    <br />

                                                }
                                                else
                                                {
                                                    <div class="media-object avatar avatar-md mr-4" style="background-image: url(demo/faces/male/16.jpg)"></div>
                                                    <br />

                                                }
                                            }
                                            @if (@doc.IsDocumentNumber == true)
                                            {
                                                @doc.DocumentNumber
                                            }

                                        </td>
                                        @* <td>
                                    <div class="media-object avatar avatar-md mr-4" style="background-image: url(demo/faces/male/16.jpg)"></div>
                                    @doc.DocumentImage<br />
                                    @doc.DocumentNumber
                                    </td> *@
                                        <td>
                                            @if (doc.DocumentNumber != null || doc.DocumentImage != null)
                                            {
                                                @doc.UpdatedAt
                                            }
                                        </td>
                                        <td>
                                            @if (doc.DocumentNumber != null || doc.DocumentImage != null)
                                            {
                                                @if (doc.IsVerified == true)
                                                {
                                                    <span class="status-icon bg-success"></span> <span>Verified</span>
                                                }
                                                else
                                                {
                                                    <span class="status-icon bg-danger"></span> <span>Not Verified</span>
                                                }
                                            }
                                            else
                                            {
                                                <span>-</span>
                                            }

                                        </td>
                                        <td>
                                            <button class="btn btn-info btn-upload"
                                                    data-document_id="@doc.DocumentId"
                                                    data-document_name="@doc.DocumentName"
                                                    data-document_image="@doc.DocumentImage"
                                                    data-document_number="@doc.DocumentNumber"
                                                    data-is_document_number="@doc.IsDocumentNumber"
                                                    data-is_document_image="@doc.IsDocumentImage"
                                                    data-worker_id="@doc.WorkerId">
                                                <i class="fe fe-upload"></i>
                                            </button>
                                        </td>
                                    </tr>

                                }

                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

@* <!-- Modal for uploading profile image -->
<div class="modal fade" id="ppUploadImageModal" tabindex="-1" aria-labelledby="ppUploadImageModalLabel" aria-hidden="true" data-backdrop="false" style="background: rgba(0, 0, 0, 0.5);">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ppUploadImageModalLabel">Upload Profile Image</h5>
                <button type="button" class="btn btn-close btnCloseModal" data-bs-dismiss="modal" aria-label="Close">
                    <b class="fe fe-x"></b>
                </button>
            </div>
            <div class="modal-body">
                <form id="ppImageUploadForm">
                    <input type="hidden" id="ppTxtWorkerId" value="@worker.WorkerId">
                    <div class="mb-3">
                        <label for="ppImageInput" class="form-label">Select Image</label>
                        <input class="form-control" type="file" id="ppImageInput" accept="image/*">
                        <input class="form-control" type="hidden" id="ppProfileImage">
                    </div>
                    <div class="mb-3">
                        <div>
                            <img id="ppImagePreview" src="#" alt="Selected Image" class="img-fluid d-none" style="max-height: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnCloseModal" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="ppImageUploadForm">Upload</button>
            </div>
        </div>
    </div>
</div> *@


<!-- Modal for uploading profile image -->
<div class="modal fade" id="ppUploadImageModal" tabindex="-1" aria-labelledby="ppUploadImageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ppUploadImageModalLabel">Upload Profile Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="ppImageUploadForm">
                    <!-- Hidden WorkerId input -->
                    <input type="hidden" id="ppTxtWorkerId" value="@worker.WorkerId">

                    <div class="mb-3">
                        <label for="ppImageInput" class="form-label">Select Image</label>
                        <input type="file" class="form-control" id="ppImageInput" accept="image/*">
                        <input class="form-control" type="hidden" id="profileImage">
                    </div>
                    <div class="mb-3">
                        <!-- Image preview -->
                        <img id="ppImagePreview" src="#" alt="Selected Image" class="img-fluid d-none" style="max-height: 200px;">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnCloseModal" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="ppImageUploadBtn">Upload</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="uploadImageModal" tabindex="-1" aria-labelledby="uploadImageModalLabel" aria-hidden="true" data-backdrop="false" style="background: rgba(0, 0, 0, 0.5).">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadImageModalLabel">Upload Document</h5>
                <button type="button" class="btn btn-close btnCloseModal" data-bs-dismiss="modal" aria-label="Close">
                    <b class="fe fe-x"></b>
                </button>
            </div>
            <div class="modal-body">
                <form id="imageUploadForm">
                    <input type="hidden" id="txtWorkerId">
                    <input type="hidden" id="txtDocumentId">
                    <div class="mb-3">
                        <label for="imageInput" class="form-label">Document Name</label>
                        <input class="form-control" type="text" id="txtDocumentName" value="Aadhar Card" disabled readonly>
                    </div>
                    <div class="mb-3 isDocumentNumber">
                        <label for="imageInput" class="form-label">Document Number</label>
                        <input class="form-control" type="text" id="txtDocumentNumber" value="285412541201">

                    </div>
                    <div class="mb-3 isDocumentImage">
                        <label for="imageInput" class="form-label">Select Image</label>
                        <input class="form-control" type="file" id="imageInput" accept="image/*">
                        <input class="form-control" type="hidden" id="documentImage">

                    </div>
                    <div class="mb-3 isDocumentImage">
                        @* <label class="form-label">Preview</label> *@
                        <div>
                            <img id="imagePreview" src="#" alt="Selected Image" class="img-fluid d-none" style="max-height: 200px;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btnCloseModal" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="imageUploadForm">Upload</button>
            </div>
        </div>
    </div>
</div>
@section Scripts {

    <script>
        $(document).ready(function () {
            // Open modal and set WorkerId dynamically
            $('.btn-upload2').on('click', function () {
                $('#ppUploadImageModal').modal('show');  // Open modal
                const workerId = $(this).data('worker-id');  // Get WorkerId from the button
                $('#ppTxtWorkerId').val(workerId);  // Set WorkerId in hidden input
                $('#ppImageInput').val('');  // Reset the file input field
                $('#ppImagePreview').addClass('d-none');  // Hide preview initially
            });

            // Close the modal when clicking close button
            $('.btnCloseModal').on('click', function () {
                $('#ppUploadImageModal').modal('hide');
            });

            // Show image preview when file is selected
            document.getElementById('ppImageInput').addEventListener('change', function (event) {
                const imageInput = event.target;
                const preview = document.getElementById('ppImagePreview');

                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.classList.remove('d-none');
                    };
                    reader.readAsDataURL(imageInput.files[0]); // Preview the selected image
                } else {
                    preview.src = '#';
                    preview.classList.add('d-none');
                }
            });

            // AJAX image upload on form submission
            $('#ppImageUploadBtn').on('click', function () {
                const formData = new FormData();
                const fileInput = document.getElementById('ppImageInput');

                if (fileInput.files && fileInput.files.length > 0) {
                    formData.append('file', fileInput.files[0]);
                } else {
                    alert('Please select an image to upload.');
                    return;
                }

                formData.append('workerId', $('#ppTxtWorkerId').val());  // Add WorkerId to formData

                $.ajax({
                    url: '/api/Worker/UploadProfileImage',  // Adjust URL as necessary
                    type: 'POST',
                    data: formData,
                    processData: false,  // Prevent jQuery from processing data
                    contentType: false,  // Prevent jQuery from setting contentType
                    // success: function (response) {
                    //     if (response.success) {
                    //         alert(response.message);  // Alert user
                    //         // Update the profile image with the new uploaded image path
                    //         $('#profileImage').css('background-image', `url('${response.filePath}')`);
                    //         $('#ppUploadImageModal').modal('hide');  // Hide modal after success
                    //     } else {
                    //         alert('Error: ' + response.message);  // Alert if error occurs
                    //     }
                    // },
                    success: function (response) {
                        if (response.success) {
                            console.log('Updated file path:', response.filePath);

                            // Force update the profile image with the new path
                            $('#profileImage').css('background-image', `url('${response.filePath}?t=${new Date().getTime()}')`);

                            // Hide the modal after successful upload
                            $('#ppUploadImageModal').modal('hide');
                        } else {
                            alert('Error: ' + response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                        alert('An error occurred while uploading the image.');
                    }
                });
            });
        });
        // $(document).ready(function () {
        //     // Open modal when the button is clicked
        //     $('.btn-upload2').on('click', function () {
        //         $('#ppUploadImageModal').modal('show');
        //         let data = $(this).data();
        //         $('#ppTxtWorkerId').val(data.worker_id);
        //         $('#ppProfileImage').val(data.profile_image); // Assuming `data.profile_image` contains an initial image URL if any
        //         $('#ppImageInput').val('');
        //         $('#ppImagePreview').addClass('d-none');
        //     });
            

        //     // Close the modal
        //     $('.btnCloseModal').on('click', function () {
        //         $('#ppUploadImageModal').modal('hide');
        //     });

        //     // JavaScript to handle image preview
        //     document.getElementById('ppImageInput').addEventListener('change', function (event) {
        //         const imageInput = event.target;
        //         const preview = document.getElementById('ppImagePreview');
        //         if (imageInput.files && imageInput.files[0]) {
        //             const reader = new FileReader();
        //             reader.onload = function (e) {
        //                 preview.src = e.target.result;
        //                 preview.classList.remove('d-none'); // Show the preview image
        //             };
        //             reader.readAsDataURL(imageInput.files[0]);
        //         } else {
        //             preview.src = '#';
        //             preview.classList.add('d-none'); // Hide the preview image
        //         }
        //     });

        //     // Handle form submission via AJAX
        //     $('#ppImageUploadForm').on('submit', function (e) {
        //         e.preventDefault();

        //         var formData = new FormData();
        //         const fileInput = document.getElementById('ppImageInput');
        //         // Proceed only if a file is selected
        //         if (fileInput.files && fileInput.files.length > 0) {
        //             formData.append('file', fileInput.files[0]);
        //         } else {
        //             alert('Please select an image to upload.');
        //             return; // Exit if no file is selected
        //         }

        //         // Add parameters
        //         formData.append('WorkerId', $('#ppTxtWorkerId').val());

        //         //Checking  Log values before sending AJAX
        //         console.log('WorkerId:', $('#ppTxtWorkerId').val());
        //         console.log('File:', fileInput.files[0]);

        //         // Send AJAX request to upload the profile image
        //         $.ajax({
        //             url: '/api/Worker/UploadProfileImage',
        //             type: 'POST',
        //             data: formData,
        //             processData: false,
        //             contentType: false,
        //             success: function (response) {
        //                 if (response.success) {
        //                     alert('Profile image uploaded successfully!');
        //                     // Update the profile image dynamically
        //                     const profileImageUrl = response.filePath;
        //                     $('#profileImage').css('background-image', `url('${profileImageUrl}')`);
        //                     // Close the modal
        //                     $('#ppUploadImageModal').modal('hide');
        //                 } else {
        //                     alert('Error: ' + response.message);
        //                 }
        //             },
        //             error: function (xhr, status, error) {
        //                 console.error('AJAX Error Status:', status);
        //                 console.error('AJAX Error Message:', error);
        //                 alert('An error occurred while uploading the profile image.');
        //             }
        //         });
        //     });
        // });





       





        //  to update the attendance summary dynamically
        function updateAttendanceSummary() {
            var selectedMonth = document.getElementById("attendanceMonth").value;
            var workerId = '@ViewBag.AllData.WorkerId'; // take  WorkerId from  ViewBag

            // Set up the request URL with the selected month and workerId
            var url = '@Url.Action("Profile", "Worker")' + '?id=' + workerId + '&attendanceMonth=' + selectedMonth;

            //  AJAX request
            $.ajax({
                url: url, 
                type: 'GET',
                success: function (data) {
                   
                    $('#PresentCount').text(data.presentCount);
                    $('#AbsentCount').text(data.absentCount);
                    $('#LeaveCount').text(data.leaveCount);
                    $('#MissCount').text(data.missCount);
                },
                error: function (xhr, status, error) {
                    
                    alert("An error occurred while fetching data: " + error);
                }
            });
        }

        
        document.getElementById('attendanceMonth').addEventListener('change', function () {
            updateAttendanceSummary();  
        });


        $(document).ready(function () {
            // Open modal when the button is clicked
            $('.btn-upload').on('click', function () {
                $('#uploadImageModal').modal('show');
                let data = $(this).data();
                $('#txtDocumentName').val(data.document_name);
                $('#txtDocumentNumber').val(data.document_number);
                $('#txtDocumentId').val(data.document_id);
                $('#txtWorkerId').val(data.worker_id);

                $('#documentImage').val(data.document_image);

                if (data.is_document_number == "False") {
                    $('.isDocumentNumber').hide();

                } else {
                    $('.isDocumentNumber').show();
                }


                if (data.is_document_image == "False") {
                    $('.isDocumentImage').hide();

                } else {
                    $('.isDocumentImage').show();
                }

                $('#imageInput').val('');
                $('#imagePreview').addClass('d-none');
            });

            $('.btnCloseModal').on('click', function () {
                $('#uploadImageModal').modal('hide');
            });

            // JavaScript to handle image preview
            document.getElementById('imageInput').addEventListener('change', function (event) {
                const imageInput = event.target;
                const preview = document.getElementById('imagePreview');

                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.classList.remove('d-none'); // Show the preview image
                    };

                    reader.readAsDataURL(imageInput.files[0]);
                } else {
                    preview.src = '#';
                    preview.classList.add('d-none'); // Hide the preview image
                }
            });

            // Handle form submission via AJAX
            $('#imageUploadForm').on('submit', function (e) {
                e.preventDefault();

                var formData = new FormData();
                const fileInput = document.getElementById('imageInput');

                // // Ensure file is selected
                if (!fileInput.files || fileInput.files.length === 0) {
                    // alert('You Have Not Selected Document File.');

                    if (!confirm('Are You Sure You Want To Continue Without Selecting File? ')) {
                        return;
                    }
                }
                else {
                    formData.append('file', fileInput.files[0]);

                }


                // Add parameters
                formData.append('WorkerId', $('#txtWorkerId').val());

                formData.append('DocumentId', $('#txtDocumentId').val());
                formData.append('DocumentNumber', $('#txtDocumentNumber').val());
                formData.append('DocumentImage', $('#documentImage').val());



                // Debugging: Log FormData keys and values
                for (let [key, value] of formData.entries()) {
                    console.log(key, value);
                }

                // Send AJAX request
                $.ajax({
                    url: '/api/Worker/UploadDocument',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log(response);
                        if (response.success) {
                            alert('Document uploaded successfully!');
                            location.reload();
                        } else {
                            alert('Error: ' + response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX Error Status:', status);
                        console.error('AJAX Error Message:', error);
                        console.error('AJAX Response Text:', xhr.responseText);
                        alert('An error occurred while uploading the document.');
                    }
                });
            });





        });
    </script>

}

